# üõ°Ô∏è Security Onion Lab: Intrusion Analysis and Alert Triage

## Overview
This lab showcases a simulated SOC workflow using **Security Onion**, demonstrating real-world skills in threat detection, network forensics, and alert triage. The objective is to investigate a set of suspicious alerts using tools like **Kibana**, **SGUIL**, **Wireshark**, and **Zeek**, and to walk through identifying malicious activity, confirming the compromise, and analyzing artifacts involved in the attack.

---

## üéØ Objectives
- Investigate IDS alerts using SGUIL and Kibana
- Validate events with Zeek and PCAP analysis
- Identify evidence of exploitation (e.g. RIG Exploit Kit, Seamonkey malware)
- Correlate indicators across multiple tools (Kibana, Wireshark, terminal logs)
- Document findings with screenshots and summaries

---

## nvestigation Workflow

### 1. Alert Triage (SGUIL)
**Screenshot:** `!![Screenshot 2025-04-06 130016](https://github.com/user-attachments/assets/97c66b09-66d3-4145-a009-eef1ac20f126)

`  
SGUIL displays a stream of alerts triggered by Snort/Suricata. Severity levels are color-coded. A key alert shows `GPL ATTACK_RESPONSE`, with destination port 6200, indicating suspicious post-exploitation activity.

---

### 2. Alert Context and Payload
**Screenshot:** `Screenshot 2025-04-06 133228.png`  


---

### 3. Metadata Summary of Attack
**Screenshot:** `![Screenshot 2025-04-06 133307](https://github.com/user-attachments/assets/6c379ae7-af07-4f98-8887-44114e1d4247)
`  
Metadata shows session data between attacker and victim IPs. Confirms bidirectional communication and post-compromise behavior.

---

### 4. Root Compromise
**Screenshot:** `![Screenshot 2025-04-06 220347](https://github.com/user-attachments/assets/86e7b2b4-4584-4b16-8649-54d3f9e9fcda)
`  
Evidence of attacker establishing root access and performing enumeration post-exploitation.

---

### 5. Bro/Zeek Log Details
**Screenshot:** ![Screenshot 2025-04-06 220639](https://github.com/user-attachments/assets/e2d29c9b-c8a7-42dd-a708-c9e178ad3d2f) , ![Screenshot 2025-04-06 222808](https://github.com/user-attachments/assets/45fac11c-169f-41fe-ba73-59f5a400f2a5)

`  
Detailed FTP session log from Zeek shows commands and data transfers, enabling a forensic timeline of the attack.

---

### 6. IDS Alert Logs (Kibana)
**Screenshot:** `Screenshot 2025-04-06 221210.png`  
Snort rules detect RIG Exploit Kit signatures in HTTP traffic. Alerts include URI patterns from known exploit campaigns targeting vulnerable browsers.

---

### 7. NIDS Summary of Exploit Events
**Screenshot:** `Screenshot 2025-04-06 221948.png`  
Kibana‚Äôs dashboard shows a spike of alerts labeled as `Trojan activity`, validating multiple exploit attempts during a short time window.

---

### 8. High-Level Alert Stats
**Screenshot:** `Screenshot 2025-04-06 222808.png`  
Kibana shows the top log types detected: bro_conn, bro_files, bro_http, and Snort. These diverse logs offer a complete picture of the attacker‚Äôs steps.

---

### 9. Suspicious JavaScript/HTML Payload
**Screenshot:** `Screenshot 2025-04-06 223612.png`  
HTML response includes an `<iframe>` redirect, often used in drive-by download attacks. The code points to a secondary site hosting exploit code.

---

### 10. Further Payload Inspection
**Screenshot:** `Screenshot 2025-04-06 223650.png`  
JavaScript uses dynamic document writing to obfuscate payload loading. These scripts often bypass basic detection.

---

### 11. Dropped Malware Sample - Seamonkey
**Screenshot:** `Screenshot 2025-04-06 224251.png`  
SeaMonkey binary downloaded to the system. Its filename pattern suggests automated or obfuscated payload delivery.

---

### 12. File Hash Verification
**Screenshot:** `Screenshot 2025-04-06 224305.png`  
The SHA1 hash of the suspicious file is calculated. This can be submitted to VirusTotal or MITRE ATT&CK for correlation.

---

### 13. Detailed Exploit Metadata in CAPME
**Screenshot:** `Screenshot 2025-04-06 225820.png`  
CAPME shows metadata from the HTTP session that delivered the payload. Includes timestamp, host headers, and User-Agent.

---

### 14. IDS Connection Table
**Screenshot:** `Screenshot 2025-04-06 234640.png`  
Connection-level view of how many alerts triggered from a single stream. Helps SOC analysts correlate sessions with malicious behavior.

---

### 15. IDS Alerts Over Time
**Screenshot:** `Screenshot 2025-04-07 001713.png`  
Time graph shows alert spike and decline‚Äîuseful for defining window of compromise.

---

### 16. Final Kibana Summary View
**Screenshot:** `Screenshot 2025-04-07 001907.png`  
Final NIDS summary confirms alert categories, highlighting the most relevant activity as Trojan behavior.

---

## Summary

In this lab, we followed the full SOC investigation lifecycle‚Äîfrom initial alert detection to packet inspection and malware analysis. The attacker used a **RIG Exploit Kit payload** via an iframe, achieved remote code execution, and exfiltrated a file via FTP. Each tool within Security Onion (SGUIL, Zeek, Kibana, Wireshark) played a key role in validating and contextualizing the event.

---

## Screenshot Index

| Step | File Name |
|------|-----------|
| SGUIL Alerts Table | `Screenshot 2025-04-06 131648.png` |
| Shell Access Stream | `Screenshot 2025-04-06 133228.png` |
| Session Metadata | `Screenshot 2025-04-06 133307.png` |
| FTP Upload | `Screenshot 2025-04-06 220347.png` |
| FTP Command Log | `Screenshot 2025-04-06 220639.png` |
| RIG EK Alert | `Screenshot 2025-04-06 221210.png` |
| Alert Spike | `Screenshot 2025-04-06 221948.png` |
| Log Type Overview | `Screenshot 2025-04-06 222808.png` |
| iframe Payload | `Screenshot 2025-04-06 223612.png` |
| JS Injection | `Screenshot 2025-04-06 223650.png` |
| Malware Saved | `Screenshot 2025-04-06 224251.png` |
| SHA1 Hash | `Screenshot 2025-04-06 224305.png` |
| CAPME Metadata | `Screenshot 2025-04-06 225820.png` |
| Stream Connection Table | `Screenshot 2025-04-06 234640.png` |
| Alert Timeline | `Screenshot 2025-04-07 001713.png` |
| NIDS Summary | `Screenshot 2025-04-07 001907.png` |

---

## Tools Used

- Security Onion
- Snort / Suricata
- Zeek (Bro)
- Kibana
- Wireshark
- Sguil
- capME


