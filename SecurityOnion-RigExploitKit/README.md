# üõ°Ô∏è Security Onion Lab: Intrusion Analysis and Alert Triage

## Overview
This lab showcases a SOC workflow and investigation using Security Onion skills in threat detection, network forensics, and alert triage. The objective is to investigate a set of suspicious alerts using tools like Kibana, SGUIL, Wireshark, and Zeek, and to identify malicious activity, confirming the compromise, and analyzing artifacts involved in the attack.

---

## üéØ Objectives

- Investigate IDS alerts using SGUIL and Kibana
- Validate events with Zeek and PCAP analysis
- Identify evidence of exploitation (e.g. RIG Exploit Kit, Seamonkey malware)
- Correlate indicators across multiple tools (Kibana, Wireshark, terminal logs)
- Document findings with screenshots and summaries

---

## Investigation Workflow

### 1. Alert Triage (SGUIL)

**Screenshot:** `!![Screenshot 2025-04-06 130016](https://github.com/user-attachments/assets/97c66b09-66d3-4145-a009-eef1ac20f126)

SGUIL displays a stream of alerts triggered by Snort/Suricata. Severity levels are color-coded. A key alert shows `GPL ATTACK_RESPONSE`, with destination port 45415, indicating suspicious activity.

---

### 2. Alert Context and Payload in Wireshark

**Screenshot:** `![Screenshot 2025-04-06 133228](https://github.com/user-attachments/assets/c5f49c75-23db-4f8d-8db8-4856134dcde4)

`  
Network packet capture data was used to view the transactions between the source and destination hosts. Within the traffic, I could see the GET requests and redirects used for the exploit. Wireshark was by far the most useful tool during this investigation. With packet capture data, connecting the pieces of the investigation together was a breeze. 

---

### 3. Metadata Summary of Attack/ Root Compromise via Metasploit

**Screenshot:** `![Screenshot 2025-04-06 133307](https://github.com/user-attachments/assets/e05c5573-db2f-4020-b7ac-f37fc1800bbe)

`  
Metadata shows session data between attacker and victim IPs. Confirms bidirectional communication and post-compromise behavior.

**Screenshot:** `![Screenshot 2025-04-06 220347](https://github.com/user-attachments/assets/86e7b2b4-4584-4b16-8649-54d3f9e9fcda)

**Screenshot:** `![Screenshot 2025-04-06 131648](https://github.com/user-attachments/assets/e8654130-7575-4e5f-846e-9bf92eb54a71)

`  
Evidence of attacker establishing root access and performing enumeration post-exploitation. 

---

### 4. Bro/Zeek Log Details

**Screenshot:** ![Screenshot 2025-04-06 220639](https://github.com/user-attachments/assets/e2d29c9b-c8a7-42dd-a708-c9e178ad3d2f) , ![Screenshot 2025-04-06 222808](https://github.com/user-attachments/assets/45fac11c-169f-41fe-ba73-59f5a400f2a5)

![Screenshot 2025-04-06 223612](https://github.com/user-attachments/assets/60cb7e85-7301-4025-969e-ba461d207c43)


Filtering of Zeek Logs to correlat with the known timeframe of the event.

---

### 5. NIDS Summary of Exploit Events

**Screenshot:** `![Screenshot 2025-04-06 224251](https://github.com/user-attachments/assets/055619c1-0248-4e51-9db8-2f648c050728)

`  
Kibana‚Äôs dashboard shows a spike of alerts labeled as "Trojan activity", validating multiple exploit attempts during a short time window.

---

### 6. IDS Alert Logs (Kibana)

**Screenshot:** `![Screenshot 2025-04-06 221210](https://github.com/user-attachments/assets/fc9679ce-547a-4f4d-9900-79e58b59a5c6)

![Screenshot 2025-04-06 221948](https://github.com/user-attachments/assets/831248dc-17cd-413c-8d6c-656fdf925228)

`  
Snort rules detect RIG Exploit Kit signatures in HTTP traffic. Alerts include URI patterns from known exploit campaigns targeting vulnerable browsers.


---

### 7. High-Level Alert Stats

**Screenshot:** `![Screenshot 2025-04-06 222808](https://github.com/user-attachments/assets/c02fec55-b330-47f4-804f-bc1ce3c935cb)

`  
Kibana shows the top log types detected: bro_conn, bro_files, bro_http, and Snort. These diverse logs offer a complete picture of the attacker‚Äôs steps.

---

### 8. Detailed Exploit Metadata in CAPME

**Screenshot:** `![Screenshot 2025-04-06 225820](https://github.com/user-attachments/assets/59e9d1b5-4c1c-4d83-afc4-39ad09e00b48)

`  
CAPME shows metadata from the HTTP session that delivered the payload. Includes timestamp, host headers, and User-Agent. Also includes the IDS rulles that were used to flag the malicious behavior. HTML response includes an `<iframe>` redirect, often used in drive-by download attacks. The code points to a secondary site hosting exploit code. JavaScript uses dynamic document writing to obfuscate payload loading. These scripts often bypass basic detection.

### 9. File Hash Verification

**Screenshot:** `![Screenshot 2025-04-06 234640](https://github.com/user-attachments/assets/d230bde4-9b83-4637-8d73-cf11677e7f33)

`  
The SHA1 hash of the suspicious file is calculated. This can be submitted to VirusTotal or MITRE ATT&CK for correlation.

---

## Summary

In this lab, we followed the full SOC investigation lifecycle‚Äîfrom initial alert detection to packet inspection and malware analysis. The attacker used a **RIG Exploit Kit payload** via an iframe, achieved remote code execution, and exfiltrated a file via FTP. Each tool within Security Onion (SGUIL, Zeek, Kibana, Wireshark) played a key role in validating and contextualizing the event.


---

## Tools Used

- Security Onion
- Snort / Suricata
- Zeek (Bro)
- Kibana
- Wireshark
- Sguil
- capME


